<?xml version="1.0" encoding="UTF-8" standalone="no"?><map version="0.8.1"><node CREATED="1426313280129" ID="4epkv8vn14tms3j6m1tp2o5gji" MODIFIED="1426313280129" TEXT="13.内容识别机制"><node CREATED="1426313280129" ID="14dcaibr7jlm4uq6g00r2q296e" MODIFIED="1426313280129" POSITION="right" TEXT="文档类型检测的逻辑"><node CREATED="1426313280129" ID="6updqm2cqrmop9asqnig3c1s0r" MODIFIED="1426313280129" TEXT="概述"><node CREATED="1426313280129" ID="36sqe6452fad4v0jopaqfaf2qj" MODIFIED="1426313280129" TEXT="没有Content-Type头域时的实现"><node CREATED="1426313280129" ID="56121045s6jbohikmh64ikjm5i" MODIFIED="1426313280129" TEXT="产生原因"><node CREATED="1426313280129" ID="4nsq5tkis80d3m4u32maqeptjg" MODIFIED="1426313280129" TEXT="忘写/写错"/><node CREATED="1426313280129" ID="055p4haohf07ftaasnlm8822a1" MODIFIED="1426313280129" TEXT="非HTTP传输机制加载"/></node><node CREATED="1426313280129" ID="46pav3au75bn91976qld5c0icd" MODIFIED="1426313280129" TEXT="浏览器检查文件的静态特征"><node CREATED="1426313280129" ID="4i0b2qgr9ldn4ct8ik41orm3dr" MODIFIED="1426313280129" TEXT="各浏览器不同"/></node></node></node><node CREATED="1426313280129" ID="3lqc5r6retjl1ni795j9c14iph" MODIFIED="1426313280129" TEXT="格式错误的MIME Type写法"><node CREATED="1426313280129" ID="7rgufd5s0jabri4vb691ajafq6" MODIFIED="1426313280129" TEXT="处理"><node CREATED="1426313280130" ID="42jg0k3hjailai78j8c03i90ka" MODIFIED="1426313280130" TEXT="RFC规定只要有Content-Type头，就不应该主动检测文件类型"/><node CREATED="1426313280130" ID="62uvt0a2921kusniuivk61ndqi" MODIFIED="1426313280130" TEXT="浏览器并未严格遵守"/></node><node CREATED="1426313280130" ID="7qoto6uc8aep3quqkejjq33fj6" MODIFIED="1426313280130" TEXT="Content-Type写法"><node CREATED="1426313280130" ID="4m524h20k1r02370aoo883h5d1" MODIFIED="1426313280130" TEXT="对于错误的格式，各浏览器有不同的处理方法"/></node></node><node CREATED="1426313280130" ID="3v9semnqajmrspokdfp1lcpmvk" MODIFIED="1426313280130" TEXT="特殊的Content-Type值"><node CREATED="1426313280130" ID="6375gf7b3isnffecpbcluul2g1" MODIFIED="1426313280130" TEXT="application/octet-stream"><node CREATED="1426313280138" ID="4revsm85ard6tuslo2qa6rtm0r" MODIFIED="1426313280138" TEXT="原意"><node CREATED="1426313280138" ID="5c9n4rm5dbv3agh1k72rjci4tq" MODIFIED="1426313280138" TEXT="Web服务器认为返回的文件对C/S端都没什么特殊含义时的设置"/></node><node CREATED="1426313280138" ID="6tajddi9evof8hrv3gocv1ibd4" MODIFIED="1426313280138" TEXT="实际"><node CREATED="1426313280138" ID="3oav9808kbu90n20l8cdsjrgqq" MODIFIED="1426313280138" TEXT="大多数Web服务器对各种不透明的非Web文件，没找到适用的Content-Type时，默认使用该类型"/></node><node CREATED="1426313280138" ID="4e43ijrtkknm91ebnf4bmm0gt4" MODIFIED="1426313280138" TEXT="浏览器"><node CREATED="1426313280138" ID="1o9ce4q0psnp906geh5m38fcjn" MODIFIED="1426313280138" TEXT="IE、Opera、Safari会启动内容检测，可能会当作HTML处理"/></node></node><node CREATED="1426313280138" ID="7g49oub00peh1blh45fjv6tgmj" MODIFIED="1426313280138" TEXT="text/plain"><node CREATED="1426313280138" ID="68lb4be1t6i0ikqe780hklpo6r" MODIFIED="1426313280139" TEXT="原意"><node CREATED="1426313280139" ID="63kc7jf0oj373aaj7sfkpga0qd" MODIFIED="1426313280139" TEXT="纯文本文件的传输"/><node CREATED="1426313280139" ID="3df64u5vu3ac2kc58dkfu06dpl" MODIFIED="1426313280139" TEXT="当发送者无法识别文档类型时的回退手段"/></node><node CREATED="1426313280139" ID="5sjc0241g4lstm86qev54j54o9" MODIFIED="1426313280139" TEXT="实际"><node CREATED="1426313280139" ID="4rqiff3e2lgrnrmn5gu2t6oc3q" MODIFIED="1426313280139" TEXT="这种处理基本不适用于Web"/><node CREATED="1426313280139" ID="29uu4htu49fccncruu8e9hjbn2" MODIFIED="1426313280139" TEXT="某些Web服务器会把text/plain作为某些类型响应的默认值（如CGI）"/></node><node CREATED="1426313280139" ID="6jcnp0t22sj0tbfj8gaf37q81l" MODIFIED="1426313280139" TEXT="浏览器"><node CREATED="1426313280139" ID="26h9i5286h9gbknk0aoanuejlg" MODIFIED="1426313280139" TEXT="IE、Safari会进行HTML检测"/></node></node></node><node CREATED="1426313280139" ID="3p473hqdd0gmi222odtvgm3v5g" MODIFIED="1426313280139" TEXT="无法识别的Content-Type值"><node CREATED="1426313280139" ID="38gjppsni070kdujljjticgo9o" MODIFIED="1426313280139" TEXT="IE会对无法识别的文件进行内容检测和后缀匹配"><node CREATED="1426313280139" ID="5253emgv6ikjefm64boo5sgh12" MODIFIED="1426313280139" TEXT="IE8以前：碰到内容不正确的JPEG图片/正确的PNG文件，会被解析成HTML"/><node CREATED="1426313280139" ID="2tg658vcu6klrv7l0gv82bgajj" MODIFIED="1426313280139" TEXT="IE8开始"><node CREATED="1426313280139" ID="0q7p4t6e5h3v7ubrfbrtgedov8" MODIFIED="1426313280139" TEXT="禁用image/*类中大多数已知图片文件的内容检测"/><node CREATED="1426313280139" ID="16n0ju48v1b1ja4esj3rjggqkq" MODIFIED="1426313280139" TEXT="发送可选的X-Content-Type-Options: nosniff头域，禁用绝大多数有争议的内容检测"/></node></node></node><node CREATED="1426313280139" ID="5iietc1ovr29ldmb3los5n3tvv" MODIFIED="1426313280139" TEXT="防御性使用Content-Disposition"><node CREATED="1426313280139" ID="6689cv48gtirbdl28pq7mnuf28" MODIFIED="1426313280139" TEXT="显示"><node CREATED="1426313280142" ID="3kkf30c6ea4r6i6fr8bcjr5cni" MODIFIED="1426313280142" TEXT="下载对话框"><node CREATED="1426313280144" ID="3qasdfcaeesmipar7ft12op8ss" MODIFIED="1426313280145" TEXT="打开"/><node CREATED="1426313280146" ID="0nh6vse9qai6o1go2vjqk5quj4" MODIFIED="1426313280146" TEXT="保存"/><node CREATED="1426313280147" ID="4tnjh48bgufa7p23oj8acpqgrd" MODIFIED="1426313280147" TEXT="取消"/></node></node><node CREATED="1426313280147" ID="2uu6q7tunl37bg6b4ljkmu57oc" MODIFIED="1426313280147" TEXT="浏览器做法"><node CREATED="1426313280147" ID="4i8krdr5p6pfk3srmp1iet7cq7" MODIFIED="1426313280147" TEXT="大多数不会直接解析或显示其返回的数据"/></node></node><node CREATED="1426313280147" ID="5b649maf8fcrih28ni4th69g18" MODIFIED="1426313280147" TEXT="子资源的内容设置"><node CREATED="1426313280147" ID="3mblrm1hpab7q7dct28ulsqi4l" MODIFIED="1426313280147" TEXT="资源请求从插件的可执行代码发出时，Content-Type和Content-Disposition无效"/><node CREATED="1426313280147" ID="6s7dmpsstgdpb1fdk3hac33ec4" MODIFIED="1426313280147" TEXT="重点关注"><node CREATED="1426313280147" ID="4nitqmvrr2v9bds46qul0trp7r" MODIFIED="1426313280147" TEXT="插件小程序和插件相关的内容"/><node CREATED="1426313280147" ID="2pgjlpoemjd8irj1t4ho6vfpn2" MODIFIED="1426313280147" TEXT="pdf"/><node CREATED="1426313280147" ID="5oqan2kbnv4r83nuoi7vuou5vk" MODIFIED="1426313280147" TEXT="css"/><node CREATED="1426313280147" ID="7mshgq4krpef8f3mhbhp4a5tu9" MODIFIED="1426313280147" TEXT="脚本"/></node></node><node CREATED="1426313280147" ID="7rcfrshkbnjpvq05ec90ilmv74" MODIFIED="1426313280147" TEXT="文件下载和其他非HTTP内容"><node CREATED="1426313280147" ID="6ukhcip481rcs044ci3lvhtj1d" MODIFIED="1426313280147" TEXT="file:、ftp:等协议"><node CREATED="1426313280147" ID="1nl00kphi01pfquu8qdsfvdau7" MODIFIED="1426313280147" TEXT="打开本地文件时，浏览器通常优先考虑扩展名（Chrome例外）"/><node CREATED="1426313280147" ID="2k0rhht1na09ko9k1e2cqmuiag" MODIFIED="1426313280147" TEXT="如果是注册给外部程序处理的扩展名，IE启动外部程序，其他浏览器启动内容检测"/><node CREATED="1426313280147" ID="00ohevn3vmgo2hftkb4mr1u3n4" MODIFIED="1426313280147" TEXT="大多数浏览器对ftp:使用内容检测"/></node></node></node><node CREATED="1426313280147" ID="38b1nodmaq0td26cpahr8g2k18" MODIFIED="1426313280147" POSITION="right" TEXT="字符集处理"><node CREATED="1426313280147" ID="072si9gp0151gue9htghnl2b1k" MODIFIED="1426313280147" TEXT="三类可能改变语义的字符集"><node CREATED="1426313280147" ID="12pg18n9g3u9cb4sq6oglknc5c" MODIFIED="1426313280147" TEXT="能用非标准方式表示7位ASCII码的字符集"><node CREATED="1426313280147" ID="2fqm26ol27t9kvdug2lhm14iv3" MODIFIED="1426313280147" TEXT="如"><node CREATED="1426313280147" ID="3kg403qmo71j8to1tlv55ncq8b" MODIFIED="1426313280147" TEXT="UTF-7"/></node></node><node CREATED="1426313280147" ID="7k5be57bj4jp6mu2k2jnkdb5uq" MODIFIED="1426313280147" TEXT="特殊前缀加上其后1或多个字节能组成有特殊含义的可变长度编码方式"><node CREATED="1426313280147" ID="2j0mcpaeco5q3pvct3eh4ttor3" MODIFIED="1426313280147" TEXT="如"><node CREATED="1426313280147" ID="5mtaagb1m4u9os1nqte9cssvjg" MODIFIED="1426313280147" TEXT="日文Shift JS"/><node CREATED="1426313280147" ID="0p8jpb8flg1mg5uta4glrmjj8g" MODIFIED="1426313280147" TEXT="韩文EUC-KR"/></node></node><node CREATED="1426313280147" ID="1bql0jq7b7jeqs9je4eb5hfltr" MODIFIED="1426313280147" TEXT="与8位ASCII码完全不兼容的编码方式"><node CREATED="1426313280147" ID="4ebmpajlo1saarjmgotfc147iu" MODIFIED="1426313280147" TEXT="如"><node CREATED="1426313280147" ID="712tkp5508baav5f5ua1h6tsoo" MODIFIED="1426313280147" TEXT="UTF-16"/><node CREATED="1426313280147" ID="7ra4aho6rk1nt18claglf78a6l" MODIFIED="1426313280148" TEXT="UTF-32"/></node></node></node><node CREATED="1426313280148" ID="0u3h50hasnnop52hk39hjn4eoc" MODIFIED="1426313280148" TEXT="字节顺序标记"><node CREATED="1426313280148" ID="253uiontuskm9ehl7660fdi4uf" MODIFIED="1426313280148" TEXT="旧版IE中，BOM优先级高于charset"/></node><node CREATED="1426313280148" ID="6c5m7ptarsj8uecertcj6kqi5v" MODIFIED="1426313280148" TEXT="字符集继承和覆盖"><node CREATED="1426313280148" ID="180ta2s803qde5mtgu7aiso3qu" MODIFIED="1426313280148" TEXT="IE的字符集继承机制"><node CREATED="1426313280148" ID="7drbumk08khgu1lpkv694in2h0" MODIFIED="1426313280148" TEXT="如果子页面缺乏有效的字符集设置，顶级框架里定义的编码会自动应用"/></node><node CREATED="1426313280148" ID="2ll7uvfjk0dgr3jq58mla57bg5" MODIFIED="1426313280148" TEXT="浏览器手工选择编码方式"/></node><node CREATED="1426313280148" ID="606d7jgmtfskgpauelsf8kplek" MODIFIED="1426313280148" TEXT="通过HTML代码设置子资源字符集"><node CREATED="1426313280148" ID="1efntb6jigp9d4nquoev0hhb4d" MODIFIED="1426313280148" TEXT="浏览器表现"><node CREATED="1426313280148" ID="06dd0mv3l2equnaavcefsequuh" MODIFIED="1426313280148" TEXT="Opera不支持"/><node CREATED="1426313280148" ID="67r8aav935ikrk19siu2cln5h1" MODIFIED="1426313280148" TEXT="IE6：HTML里的编码设定优先级高于HTTP数据中的Content-type"/></node></node><node CREATED="1426313280148" ID="2jiihiob4p3fb9m127pb0tfiu5" MODIFIED="1426313280148" TEXT="非HTTP文件的编码检测"><node CREATED="1426313280148" ID="01otj645f8oaejd2pusj3hracg" MODIFIED="1426313280148" TEXT="对HTML文件来说，可以在文档内部嵌入某条&lt;meta&gt;指令设置"/></node></node><node CREATED="1426313280148" ID="5kr2cftupo6nugqolsl3usij47" MODIFIED="1426313280148" POSITION="left" TEXT="安全工程速查表"><node CREATED="1426313280148" ID="276pkemu7nft559gvpvk65l752" MODIFIED="1426313280148" TEXT="对所用网站都适用的良好的安全习惯"><node CREATED="1426313280148" ID="6trsta68le9b341jheb91l1h5n" MODIFIED="1426313280148" TEXT="添加X-Content-Type-OPtions头"/><node CREATED="1426313280148" ID="545r54a66mosmk4thfb40vlujo" MODIFIED="1426313280148" TEXT="设置合理的crossdomain策略文件"/><node CREATED="1426313280148" ID="4oevg5mg4erma10m16mt1avaah" MODIFIED="1426313280148" TEXT="对所有响应加上charset和Content-Type的值"/><node CREATED="1426313280148" ID="781irbmthn8knf03p8d28dl76r" MODIFIED="1426313280148" TEXT="禁用PATH_INFO"/></node><node CREATED="1426313280148" ID="4bbqr29lbu0bjhhp0ovk95824s" MODIFIED="1426313280148" TEXT="产生的文档里有部分内容可由攻击者控制时"><node CREATED="1426313280148" ID="6fvffvv8bgnt2v2mtptk4ctk0c" MODIFIED="1426313280148" TEXT="总是返回一个明确有效和常用的Content-Type值"/><node CREATED="1426313280148" ID="0be017lla9ddhnb2h3kvrkh8tm" MODIFIED="1426313280148" TEXT="设置明确有效和长远的charset值"/><node CREATED="1426313280148" ID="3bn9chrm113bv3oog1o1muu5bq" MODIFIED="1426313280148" TEXT="对JSON等不需要直接显示内容的响应，使用Content-Disposition: attachment头设置合理的文件名"/><node CREATED="1426313280148" ID="6n5h57gokovll7rv1ckcnem2ds" MODIFIED="1426313280148" TEXT="不要允许用户控制文件的前几个字节"/><node CREATED="1426313280148" ID="0btrbfl5rk0megm6s4ek2iab0d" MODIFIED="1426313280148" TEXT="在服务器端做编码转换时，拒绝所有意外或无效的输入"/></node><node CREATED="1426313280148" ID="2cfmj12e4rv9phf6ilt2eg1rns" MODIFIED="1426313280148" TEXT="存放用户提供的文件时"><node CREATED="1426313280148" ID="226bptn6vb6bgtfvk74ta71nem" MODIFIED="1426313280148" TEXT="尽量使用沙盒域名"/><node CREATED="1426313280148" ID="1kbpb160igh77m3hj5fqsa8vvc" MODIFIED="1426313280148" TEXT="使用Content-Disposition: attachment响应头"/><node CREATED="1426313280148" ID="3ocngb6aju6r60650s92v9fn2e" MODIFIED="1426313280148" TEXT="仔细校验输入的数据，总是使用便于识别的恰当MIME类型"/><node CREATED="1426313280148" ID="7050e01ohibqr5h5lmogg3tepu" MODIFIED="1426313280149" TEXT="避免使用application/octet-stream"/><node CREATED="1426313280149" ID="4m8u6k4f9bc57alttm3q8obb0f" MODIFIED="1426313280149" TEXT="避免返回text/plain"/><node CREATED="1426313280149" ID="6edkul10cbva5lrfqpe5ul3fjh" MODIFIED="1426313280149" TEXT="不要允许用户设定Content-Type头"/></node></node></node></map>