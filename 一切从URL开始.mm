<?xml version="1.0" encoding="UTF-8" standalone="no"?><map version="0.8.1"><node CREATED="1426313405437" ID="7dkrqju65m1mc2dm21ijq9mje3" MODIFIED="1426313405437" TEXT="2.一切从URL开始"><node CREATED="1426313405437" ID="6dorkqmrlos62smgijj5mslemr" MODIFIED="1426313405438" POSITION="right" TEXT="概述"><node CREATED="1426313405438" ID="4f9scklc2jk5suek34mld8llhi" MODIFIED="1426313405438" TEXT="URL"><node CREATED="1426313405438" ID="4r59j5stpudufvn5k7917dg00f" MODIFIED="1426313405438" TEXT="真URL"/><node CREATED="1426313405438" ID="4d0lv1mdh6e7fpdr3ispet61qi" MODIFIED="1426313405438" TEXT="伪URL"><node CREATED="1426313405438" ID="2fbgnt4m0gt3u0pgfnnu1le653" MODIFIED="1426313405438" TEXT="内置的脚本引擎"/><node CREATED="1426313405438" ID="4rl7fqcscqp4t9saf2lvtll6sh" MODIFIED="1426313405438" TEXT="特别的文档渲染模式"/><node CREATED="1426313405438" ID="5ujcairdk9m1etgb9o0r8kpup1" MODIFIED="1426313405438" TEXT="……"/></node></node><node CREATED="1426313405438" ID="4ta7lj5bqt0aj3ltnm46r4gi3i" MODIFIED="1426313405438" TEXT="标准"><node CREATED="1426313405438" ID="7unq3taslsp7echgegllfhg1a7" MODIFIED="1426313405438" TEXT="RFC3986"/><node CREATED="1426313405438" ID="78hvhtvg8f1q5f6j9ce6qkt6f5" MODIFIED="1426313405438" TEXT="在Web里的实际运用"><node CREATED="1426313405438" ID="19peiv5smkbm14lv92vmg50the" MODIFIED="1426313405438" TEXT="RFC1738、2616"/></node></node></node><node CREATED="1426313405438" ID="0hsg0jf64pp60ucare19q8i3eu" MODIFIED="1426313405438" POSITION="right" TEXT="URL的结构"><node CREATED="1426313405438" ID="5aj3k9b153psr6d0oqiiks54k6" MODIFIED="1426313405438" TEXT="协议名称"><node CREATED="1426313405438" ID="3d6l8e22eldhsri70m5tigk4kn" MODIFIED="1426313405438" TEXT="一串不区分大小写的字符串组成，以单个冒号结束"/><node CREATED="1426313405438" ID="6oe3cmmauc3gsn1d6oduf76po8" MODIFIED="1426313405438" TEXT="IANA维护官方认可的有效URL协议"/><node CREATED="1426313405438" ID="7c4u4s8a1598845uverag5pop8" MODIFIED="1426313405438" TEXT="区分绝对URL还是相对URL"><node CREATED="1426313405438" ID="5632f5b6t3qpls3s7qtv9ncq95" MODIFIED="1426313405438" TEXT="RFC1738定义"><node CREATED="1426313405438" ID="6f51ut5fo8v00d8ptpim5db0us" MODIFIED="1426313405438" TEXT="绝对URL在:之前只能出现字母数字、“+”、“-”和“.”"/></node><node CREATED="1426313405438" ID="0vhf4981p3jmt904h28au902qd" MODIFIED="1426313405438" TEXT="实际"><node CREATED="1426313405438" ID="7krjirehotolrrju4csrl59moe" MODIFIED="1426313405438" TEXT="全部忽略前导换行符和空格"/><node CREATED="1426313405438" ID="1bpbd53jitef0sf9r1uf58iplh" MODIFIED="1426313405438" TEXT="大多数浏览器还会忽略协议名出现的换行符和制表符"/><node CREATED="1426313405438" ID="3gk3pvo3en0s2qeicmif23caia" MODIFIED="1426313405438" TEXT="IE"><node CREATED="1426313405438" ID="0bolv6eht1dbpmt9f09h3r5ft0" MODIFIED="1426313405438" TEXT="忽略所有不可打印字符"/></node><node CREATED="1426313405438" ID="3ga9lpskb2r4kujs11908sh2ja" MODIFIED="1426313405438" TEXT="Chrome"><node CREATED="1426313405438" ID="4gnfedhe6k92o32mjb5pkmo09e" MODIFIED="1426313405438" TEXT="忽略所有不可打印字符、0x00、NUL"/></node><node CREATED="1426313405438" ID="7htrvlq7km5ugl9actqarkch2u" MODIFIED="1426313405438" TEXT="Opera"><node CREATED="1426313405438" ID="6l8m9uqa7vgug7120svftdrvoh" MODIFIED="1426313405438" TEXT="接受协议字符串出现高位字符"/></node></node><node CREATED="1426313405438" ID="7vqt492038andtetu8itqetue1" MODIFIED="1426313405438" TEXT="拒绝任何异常的语法是不够的"/></node></node><node CREATED="1426313405438" ID="5g0rkmi048hrme9h97umtica56" MODIFIED="1426313405438" TEXT="层级URL的标记符号"><node CREATED="1426313405438" ID="2jlqr0k786ke3fvar19jc1rpna" MODIFIED="1426313405438" TEXT="RFC1738定义"><node CREATED="1426313405438" ID="3q3hgrkb760pnnecs6nm461fqo" MODIFIED="1426313405438" TEXT="在授权信息之前，每个层级结构的绝对URL里都应包括固定的字符串“//”"/><node CREATED="1426313405438" ID="16n1vds7jcg9i7k6822pr8d9qp" MODIFIED="1426313405438" TEXT="如果没有，只能看成一个含糊的与特定协议相关的值"><node CREATED="1426313405438" ID="7jpdpee769qql1hjk15fuohcuj" MODIFIED="1426313405438" TEXT="子主题 1"/></node></node><node CREATED="1426313405438" ID="6jmooosq7slb9n42ritb73bq8k" MODIFIED="1426313405438" TEXT="缺陷"><node CREATED="1426313405438" ID="5lo3fpt3l3p3p9e1e6nsrrvikg" MODIFIED="1426313405438" TEXT="没有指明"><node CREATED="1426313405438" ID="02hj256n79og0keotj2a1k5cag" MODIFIED="1426313405438" TEXT="如果碰到一个非层级结构的URL带有“//”前缀，怎么处理"/><node CREATED="1426313405438" ID="22slfcc2bueqnga1sh2pl8dgue" MODIFIED="1426313405438" TEXT="反之亦然"/></node><node CREATED="1426313405438" ID="5nnvsq3ha26453q2h94mqd0muq" MODIFIED="1426313405438" TEXT="示例"><node CREATED="1426313405438" ID="5p6s50o8uasthurbeufirr7klh" MODIFIED="1426313405438" TEXT="http:example.com/"><node CREATED="1426313405438" ID="4ilchvf8st7joa53ct3dse7hod" MODIFIED="1426313405438" TEXT="Firefox、Chrome、Safari"><node CREATED="1426313405439" ID="0m177gru2pt5cvrau67uln4m1a" MODIFIED="1426313405439" TEXT="没有基准URL：认为http://example.com/"/><node CREATED="1426313405439" ID="4hr2d2tt99bmcaoijlscij7761" MODIFIED="1426313405439" TEXT="有基准URL：认为是一个指向目录example.com的相对路径"/></node></node><node CREATED="1426313405439" ID="71t95lfbr5qdi6b4siml6sieua" MODIFIED="1426313405439" TEXT="javascript://example.com/%0Aalert(1)"><node CREATED="1426313405439" ID="7qngpf77bggrnajdeo30cccfsh" MODIFIED="1426313405439" TEXT="所有常用浏览器：认为是一个有效的非层级伪URL，并以JS执行"/></node><node CREATED="1426313405439" ID="1l6jc3mmetkjdvt814rah5qb07" MODIFIED="1426313405439" TEXT="mailto://user@example.com"><node CREATED="1426313405439" ID="0pa0pu1i1fca6c5et5c4se3pe3" MODIFIED="1426313405439" TEXT="IE"><node CREATED="1426313405439" ID="6daua30pul29j50i2lo8s2afog" MODIFIED="1426313405439" TEXT="去掉//，认为是有效的URL"/></node><node CREATED="1426313405439" ID="6780u2u3o95dnjg440v4ijj92n" MODIFIED="1426313405439" TEXT="其他浏览器"><node CREATED="1426313405439" ID="2qqerdbnteuvadtsvn9kr67cvu" MODIFIED="1426313405439" TEXT="不认可"/></node></node></node></node></node><node CREATED="1426313405439" ID="2nthfg38ktleo8dhat7g8lvq5p" MODIFIED="1426313405439" TEXT="访问资源的身份验证"><node CREATED="1426313405439" ID="4n1vda53jm5bk8f8vefqpq1edm" MODIFIED="1426313405439" TEXT="可选项，指定用户名或密码"><node CREATED="1426313405439" ID="285cpmiqhb1lmdu89b3rgcshl8" MODIFIED="1426313405439" TEXT="未提供时"><node CREATED="1426313405439" ID="5i5q6tt40t61t90ckmttoiurgk" MODIFIED="1426313405439" TEXT="http和其他几种协议"><node CREATED="1426313405439" ID="3hbjdf4lkqgi2ha32402ndjni0" MODIFIED="1426313405439" TEXT="没有传送任何身份验证信息"/></node><node CREATED="1426313405439" ID="6007anpm7vshc2u9rse4pgssj9" MODIFIED="1426313405439" TEXT="FTP"><node CREATED="1426313405439" ID="21nqt6863cnb7u9mtit1aa4h76" MODIFIED="1426313405439" TEXT="包含名为ftp的帐号，和一个假的密码"/></node></node></node><node CREATED="1426313405439" ID="3cemkubl3rlnev0184avln2rvq" MODIFIED="1426313405439" TEXT="对不支持身份验证的协议，如果在URL中插入本字段如何处理，没有规定"/><node CREATED="1426313405439" ID="2b7k67se9tia1h6h4h6nncer7u" MODIFIED="1426313405439" TEXT="接受字符"><node CREATED="1426313405439" ID="6792ie2od4m23iap0noi4g159g" MODIFIED="1426313405439" TEXT="大多数浏览器几乎接受任何字符"/><node CREATED="1426313405439" ID="133f6f9ubk0o70lvlqs9lha464" MODIFIED="1426313405439" TEXT="Safari"><node CREATED="1426313405439" ID="0avsja7fql8gp6vgq9cudkmget" MODIFIED="1426313405439" TEXT="拒绝了很多字符，如&lt;、&gt;、{、}"/></node><node CREATED="1426313405439" ID="4r6ilis0u95d78rg6m9suvjdqb" MODIFIED="1426313405439" TEXT="Firefox"><node CREATED="1426313405439" ID="57blj9tl290jrj48ar17omauq5" MODIFIED="1426313405439" TEXT="拒绝换行符"><node CREATED="1426313405439" ID="0h7vke6rvhqftuk8lr81us9nm1" MODIFIED="1426313405439" TEXT="否则会被解析为一个新的FTP命令的开始"/><node CREATED="1426313405439" ID="56ceuaespm4bf7kjtdbe65o9t5" MODIFIED="1426313405439" TEXT="其他浏览器会把不符合规范的字符百分号编码，或丢弃"/></node></node></node></node><node CREATED="1426313405439" ID="4gs0h559qcst2jo2hdqnphfdcu" MODIFIED="1426313405439" TEXT="服务器地址"><node CREATED="1426313405441" ID="23maal1kiid8l69o0chco74b9f" MODIFIED="1426313405441" TEXT="接受字符"><node CREATED="1426313405442" ID="4ov21l04l71gjtoqcl8qf7lqsp" MODIFIED="1426313405442" TEXT="指定一个不区分大小写的域名、IPV4地址、一对方括号里的IPV6地址"/><node CREATED="1426313405442" ID="3qlfmua4diccou2e28ni8tfjoh" MODIFIED="1426313405442" TEXT="Firefox"><node CREATED="1426313405443" ID="2qo4f5avt3o65i3l7d46gikht5" MODIFIED="1426313405443" TEXT="还接受在一对方括号中的IPV4地址和主机名"/></node><node CREATED="1426313405443" ID="2rsu9vcoc4v2hu7qmu5a57i40j" MODIFIED="1426313405443" TEXT="大多数应用可接受八进制、十进制和十六进制的写法，甚至可以接受把其中几个或全部8位元数据拼在一起再转成单个整数的写法"/><node CREATED="1426313405443" ID="3vnaitk50to6ukvd7vfigo9gqu" MODIFIED="1426313405443" TEXT="域名"><node CREATED="1426313405443" ID="13qpqcr1d96v1o9tle1gmh6as0" MODIFIED="1426313405443" TEXT="RFC1035定义：只能出现字母、数字、”.”和“-”"/><node CREATED="1426313405443" ID="7ge1m4g3uam7rb86c1q6hpek2c" MODIFIED="1426313405443" TEXT="浏览器依赖于操作系统的解析器"><node CREATED="1426313405443" ID="1qt6fqhoj3kclc7je8hj88knr3" MODIFIED="1426313405443" TEXT="Safari最严谨，IE最宽容"/></node><node CREATED="1426313405443" ID="6opu1s25rpcnuhabe9ivu4j1nv" MODIFIED="1426313405443" TEXT="大部分浏览器不接受0x0A-0x0D和0xA0-0xAD间的控制字符"/><node CREATED="1426313405443" ID="6brphnanvlkuccrgl1k4af3fll" MODIFIED="1426313405443" TEXT="主流URL解析器会把&quot;。&quot;解析为&quot;.&quot;"/></node></node></node><node CREATED="1426313405443" ID="6thl14btuo35bnn85fdcrfe3i5" MODIFIED="1426313405443" TEXT="服务器端口"><node CREATED="1426313405443" ID="0u2sad83vji9596bcfnqa3rjif" MODIFIED="1426313405443" TEXT="问题"><node CREATED="1426313405443" ID="6q5k8o64r55fjcn8629i48loe3" MODIFIED="1426313405443" TEXT="可以用浏览器向任意网络服务发送攻击者提供的数据，尽管浏览器不支持这些服务的协议"/></node></node><node CREATED="1426313405443" ID="5riqo22i31onckah1020n8ioq8" MODIFIED="1426313405443" TEXT="层级的文件路径"><node CREATED="1426313405443" ID="0bompoa3hdgkrrodn8aip1b18q" MODIFIED="1426313405443" TEXT="从UNIX目录语义借用过来的"/></node><node CREATED="1426313405443" ID="3dipbmj7g3dr85aaqiufvtqc1s" MODIFIED="1426313405443" TEXT="查询字符串"><node CREATED="1426313405443" ID="662cu42rpso7dnj9g614mkvmlg" MODIFIED="1426313405443" TEXT="可选项，把一串非层级格式的任意参数传递给由前面路径所对应的资源"/><node CREATED="1426313405443" ID="1s2cttbq5cesgn81f8s5i0f8ud" MODIFIED="1426313405443" TEXT="RFC并没有硬性规定格式"/></node><node CREATED="1426313405443" ID="5q3jpn9pfilv4fadnnk5hm9013" MODIFIED="1426313405443" TEXT="片段ID"><node CREATED="1426313405443" ID="3hbod8gecfles940v7cjt6250q" MODIFIED="1426313405443" TEXT="可选项，只用于客户端，并不传给服务器端"/><node CREATED="1426313405443" ID="2hm65oa9mgcigk5pkvoi8cgkq0" MODIFIED="1426313405443" TEXT="RFC没有明确规定其格式或功能，只暗示可用于在返回的文档里定位“子资源”或对文档渲染的方式提供一些帮助性的指导"/><node CREATED="1426313405444" ID="4klkvghpkb0uce2t1mrqfamkp1" MODIFIED="1426313405444" TEXT="用途"><node CREATED="1426313405444" ID="402g8qs19ave6kqvqhhqe8050e" MODIFIED="1426313405444" TEXT="锚点进行页面内定位"/><node CREATED="1426313405444" ID="74cvsef6bcfo41qbglglurvg9s" MODIFIED="1426313405444" TEXT="存放临时数据"/></node></node><node CREATED="1426313405444" ID="76la10880r22853a3f9s3aopv9" MODIFIED="1426313405444" TEXT="把所有的东西整合起来"><node CREATED="1426313405444" ID="60r8tq2tqa1ch75dspc02nku5c" MODIFIED="1426313405444" TEXT="元字符"><node CREATED="1426313405444" ID="43tb13gouc56vpfmjo8k6mouph" MODIFIED="1426313405444" TEXT="正斜杠（/）、冒号、问号等"/></node><node CREATED="1426313405444" ID="4rgs3pcm8r1jqd30r60aiv7b77" MODIFIED="1426313405444" TEXT="步骤"><node CREATED="1426313405444" ID="0d0f4nvr55l0d19pcarf1cic81" MODIFIED="1426313405444" TEXT="提取协议名称"><node CREATED="1426313405444" ID="0cdah8h8uci8uhmslvio7o7bjt" MODIFIED="1426313405444" TEXT="扫描第一个&quot;:&quot;字符，左边的就是协议名称"/></node><node CREATED="1426313405444" ID="7duggsd84m0fo9d338jatciubt" MODIFIED="1426313405444" TEXT="去除层级URL标记符"><node CREATED="1426313405444" ID="431t4sbm10dpf7ep1u7pb0lulr" MODIFIED="1426313405444" TEXT="协议名称后面，如果没有，则跳过"><node CREATED="1426313405444" ID="592t776m3f7fllfk6tl2vjtfeg" MODIFIED="1426313405444" TEXT="都支持&quot;\&quot;代替&quot;/&quot;（与原文不同，目前Firefox也已经支持）"><icon BUILTIN="ksmiletris"/></node></node></node><node CREATED="1426313405444" ID="4evvf4kduniksrcjuc5pdnbkvg" MODIFIED="1426313405444" TEXT="获取授权信息部分"><node CREATED="1426313405444" ID="28h4agd0bc8ibb121l53ljmlfp" MODIFIED="1426313405444" TEXT="截取"><node CREATED="1426313405444" ID="5606rep09pvv0sbknhjf3acesb" MODIFIED="1426313405444" TEXT="依次扫描/、?、#，哪个先以哪为准截取"/><node CREATED="1426313405444" ID="13922vean19vjmsk1qairg0js8" MODIFIED="1426313405444" TEXT="除IE和Safari外，分号也是可接受的分隔符"><node CREATED="1426313405444" ID="144rlon00ilv6gd448gtgs8jbi" MODIFIED="1426313405444" TEXT="IE会成功解析这个地址"/><node CREATED="1426313405444" ID="6ac36h130l8k8sns4kt0q1tp3k" MODIFIED="1426313405444" TEXT="Safari会认为语法错误"/><node CREATED="1426313405444" ID="3r6htdfs7rll1taa3iqefe5cd1" MODIFIED="1426313405444" TEXT="其他的自动修改URL为/;"/></node></node><node CREATED="1426313405444" ID="0g8ncsm8s6pcf9fi4ekilabbaq" MODIFIED="1426313405444" TEXT="步骤"><node CREATED="1426313405444" ID="4t1hjr9sv3ndp65v4d0jbtbjt2" MODIFIED="1426313405444" TEXT="定位登录信息，如果有的话"><node CREATED="1426313405445" ID="07gtdvpd9e1r9qdjrba31n4lcv" MODIFIED="1426313405445" TEXT="寻找@"/><node CREATED="1426313405445" ID="50frvhmo7dofh3ocbs1inpgmd6" MODIFIED="1426313405445" TEXT="第一个冒号前面是用户名，后面是密码"/></node><node CREATED="1426313405445" ID="60e3erafpn7t0ron4nj59t97af" MODIFIED="1426313405445" TEXT="提取目标地址"><node CREATED="1426313405445" ID="5d0dif2jtaif1sb236j9sij7ca" MODIFIED="1426313405445" TEXT="第一个冒号分隔开的是主机名和端口号"/></node></node></node><node CREATED="1426313405445" ID="6g7kauapeh66648j3th6ikuj4t" MODIFIED="1426313405445" TEXT="确定路径（如果有的话）"><node CREATED="1426313405445" ID="245mf9n1e75q4n2ppfn6k3nf4h" MODIFIED="1426313405445" TEXT="如果授权部分的结尾跟着一个/（或某些场景的\或分号）"><node CREATED="1426313405445" ID="7q8lsahdgbd5aivdqhcn999tqi" MODIFIED="1426313405445" TEXT="扫描下一个?、#或字符串尾截取"/></node></node><node CREATED="1426313405445" ID="70q8e9qkka575bfq7edjmicsog" MODIFIED="1426313405445" TEXT="提取查询字符串（如果有的话）"><node CREATED="1426313405445" ID="37o9658b1fbr2lsdmks2vrt4tu" MODIFIED="1426313405445" TEXT="扫描#或字符串尾截取"/></node><node CREATED="1426313405445" ID="7v7ihc4ncdtc12iar6oemsepgf" MODIFIED="1426313405445" TEXT="提取片段ID（如果有的话）"/></node><node CREATED="1426313405445" ID="7d9vm113olschvsft2mvjnl9fr" MODIFIED="1426313405445" TEXT="示例"/></node></node><node CREATED="1426313405445" ID="1d4655d9qqhbol6303ee1i6v2r" MODIFIED="1426313405445" POSITION="right" TEXT="保留字符和百分号编码"><node CREATED="1426313405445" ID="4v1emankudooeuhp0uue13094g" MODIFIED="1426313405445" TEXT="保留字符"><node CREATED="1426313405445" ID="66mk281ug6fda74ddm50ot3a2i" MODIFIED="1426313405445" TEXT="URL里会破坏语法的分隔符"><node CREATED="1426313405445" ID="2konugs1upuboprg6r8n9cvplu" MODIFIED="1426313405445" TEXT=": / ? # [ ] @"/></node><node CREATED="1426313405452" ID="6mel1vmbgqhtdvpqmo0hqa39u8" MODIFIED="1426313405452" TEXT="RFC规定的底层分隔符"><node CREATED="1426313405452" ID="0kc55vlj714905q6mlcmuvpl01" MODIFIED="1426313405452" TEXT="! $ &amp; ' ( ) * + , ; ="/></node></node><node CREATED="1426313405452" ID="39isq487vq4p87k4jfjogvcdad" MODIFIED="1426313405452" TEXT="百分号编码"><node CREATED="1426313405452" ID="19qcd78f4u0lo0enkg00hdlp6n" MODIFIED="1426313405452" TEXT="保留字符原则上是被禁止的，但没有给出处理方法"/><node CREATED="1426313405452" ID="1vpep0r43u58s73o91krm6l8re" MODIFIED="1426313405452" TEXT="中间程序不要对URL中的保留字符再进行编解码"/></node><node CREATED="1426313405452" ID="137fldvsbqs0ficdoo8vn9pb0q" MODIFIED="1426313405452" TEXT="保留字符的处理"><node CREATED="1426313405452" ID="0sdlscbraf45ms6dkhs13322ro" MODIFIED="1426313405452" TEXT="各浏览器不一致"/></node><node CREATED="1426313405452" ID="3jrdl88ki5jbgrfhbv0rgqakri" MODIFIED="1426313405452" TEXT="非保留字符子集"><node CREATED="1426313405452" ID="7g3eq1avole6oft721i84ervel" MODIFIED="1426313405452" TEXT="字母数字、-、_、.、~"/><node CREATED="1426313405452" ID="4j9rtma4ip6r4mtlu70ehjrtkd" MODIFIED="1426313405452" TEXT="只有这个子集里的字符和位于正确位置上的保留字符才允许出现在URL里"/><node CREATED="1426313405452" ID="1f57hgdid5v08puug1hfgrhvch" MODIFIED="1426313405452" TEXT="但是没禁止非保留字符以编码形式出现"><node CREATED="1426313405452" ID="0pdrs16oc0fv6p5pts8l00cetv" MODIFIED="1426313405452" TEXT="广泛用于社工"/><node CREATED="1426313405452" ID="092poq3mdjv052t58ggbem0vlh" MODIFIED="1426313405452" TEXT="浏览器"><node CREATED="1426313405452" ID="6n7tadtssercu7r9e1o2jdm65n" MODIFIED="1426313405452" TEXT="Firefox禁止出现"/><node CREATED="1426313405453" ID="657ogrdns7tl48or4i3acg3nql" MODIFIED="1426313405453" TEXT="Chrome等强制解码"/></node></node></node><node CREATED="1426313405453" ID="7a3ls73sbqfusr385s32cknnog" MODIFIED="1426313405453" TEXT="不在保留字符和非保留字符集中的"><node CREATED="1426313405453" ID="4tb823jgojv11hee1uo8psfqu2" MODIFIED="1426313405453" TEXT="RFC规定无条件编码"/><node CREATED="1426313405453" ID="3dm9jfepltu9b3e1jc7afoluuo" MODIFIED="1426313405453" TEXT="浏览器行为"><node CREATED="1426313405453" ID="1f5e72ihsc1968m6lrrtn67lf7" MODIFIED="1426313405453" TEXT="都允许^ { | }"/><node CREATED="1426313405453" ID="7r4329asvom1m2lun30j6f6uhl" MODIFIED="1426313405453" TEXT="IE允许&lt; &gt; `"/><node CREATED="1426313405453" ID="7s7mnul5hoo36qj31h4brclmik" MODIFIED="1426313405453" TEXT="IE、Firefox、Chrome接受\"/><node CREATED="1426313405453" ID="1apssn91ffk0mof8p0a1iodfvd" MODIFIED="1426313405453" TEXT="Chrome和IE允许双引号"/><node CREATED="1426313405453" ID="0i77195cvrgfcp51ifl1j7082v" MODIFIED="1426313405453" TEXT="Opera和IE允许0x7F(DEL)"/></node></node><node CREATED="1426313405453" ID="4ar78ugdkvrj9g0vgblidfj2jf" MODIFIED="1426313405453" TEXT="绝大部分浏览器对片段ID不编码"/><node CREATED="1426313405453" ID="4mpktqslmf6bmemko38ek42o65" MODIFIED="1426313405453" TEXT="对非US-ASCii文本字符的处理"><node CREATED="1426313405453" ID="3phhuiuqak0alp3q4bmrdc3e3q" MODIFIED="1426313405453" TEXT="字符集和代码页"/><node CREATED="1426313405453" ID="62p79uc9i9ig9s3hob63k98il3" MODIFIED="1426313405453" TEXT="Unicode -&gt; UTF-8被认可的缓慢，Web协议已固定成型"/><node CREATED="1426313405453" ID="2blk2690jnhgldh4l7c72uo9r7" MODIFIED="1426313405453" TEXT="问题"><node CREATED="1426313405453" ID="4f73os5csj0pruqd9db2v6lctp" MODIFIED="1426313405453" TEXT="URL里传递的高位字符，不知道按哪种代码页解析"/></node><node CREATED="1426313405453" ID="5vgonq2c7kn320v6hd0kf1ar12" MODIFIED="1426313405453" TEXT="服务器地址编码没有碰到百分号编码的问题，因为没有高位字符"><node CREATED="1426313405453" ID="667dano9jqpqfnhv44t0m4h2gr" MODIFIED="1426313405453" TEXT="IDNA的Punycode格式"><node CREATED="1426313405453" ID="3nkk9q7tjnlnqbloonbu6d29ih" MODIFIED="1426313405453" TEXT="漏洞"><node CREATED="1426313405453" ID="6h1khivl1unvjq69ci1dm7bpn9" MODIFIED="1426313405453" TEXT="使用长相相似但不是同一个Unicode编码的字符"/></node></node><node CREATED="1426313405454" ID="5htfon56lt82cjkg0af1a4pdpe" MODIFIED="1426313405454" TEXT="现在已经允许中文域名等这种情况了（本书之后）"><icon BUILTIN="bookmark"/></node></node></node></node><node CREATED="1426313405454" ID="0vl7a36o2pfoikkssp426r9bjl" MODIFIED="1426313405454" POSITION="right" TEXT="常见的URL协议及功能"><node CREATED="1426313405454" ID="4mtufrcqe44pp5a6b955p4mgf5" MODIFIED="1426313405454" TEXT="浏览器本身支持、与获取文档相关的协议"><node CREATED="1426313405454" ID="4dmhj6psqunbmc3sq81hqdopch" MODIFIED="1426313405454" TEXT="由浏览器内部直接处理，通过特定的传输协议，获取指定文档内容，通过常规的内核解析引擎的逻辑处理"/><node CREATED="1426313405454" ID="4pdt25hiq8v4usp05f3nt0bunf" MODIFIED="1426313405454" TEXT="协议"><node CREATED="1426313405454" ID="1i38frh38f6t373gv7uss0kqcl" MODIFIED="1426313405454" TEXT="http:"/><node CREATED="1426313405454" ID="41b4ih4cvsdoau4hb0eobuc0ob" MODIFIED="1426313405454" TEXT="https:"/><node CREATED="1426313405454" ID="60pv7sigh67effahrebftc94vs" MODIFIED="1426313405454" TEXT="ftp:"/><node CREATED="1426313405454" ID="4q9u9g1r1292uc6mnoahvks681" MODIFIED="1426313405454" TEXT="local:"><node CREATED="1426313405454" ID="2tpk4utkjb6r444hg8mhjj8gip" MODIFIED="1426313405454" TEXT="以前又叫local:"/><node CREATED="1426313405454" ID="00dmtunevefihels2d5pjimstj" MODIFIED="1426313405454" TEXT="用于访问本地文件系统或NFS/SMB共享"/><node CREATED="1426313405454" ID="37thdht034n3f9n7fmat01qe1k" MODIFIED="1426313405454" TEXT="无法从互联网上的网页访问到"/></node><node CREATED="1426313405454" ID="01sv8rs0303ipai1fq8jdjsgjo" MODIFIED="1426313405454" TEXT="gopher:"><node CREATED="1426313405454" ID="3smsf0bugi9to4f296tpv7v9to" MODIFIED="1426313405454" TEXT="早期的Web原型"/><node CREATED="1426313405454" ID="4i5hvbbunj4e4vedh8rah92mra" MODIFIED="1426313405454" TEXT="只有Firefox还支持"/></node><node CREATED="1426313405454" ID="40uh3ngmq1ngfb8oi5skg2754g" MODIFIED="1426313405454" TEXT="shttp:"><node CREATED="1426313405454" ID="26oqsk92i6eodnd8odhe9dbiqg" MODIFIED="1426313405454" TEXT="失败的https尝试"/><node CREATED="1426313405454" ID="5do49ihdelulpdgn1tfokj2v97" MODIFIED="1426313405454" TEXT="只有IE支持，且为http的别名"/></node></node></node><node CREATED="1426313405454" ID="25t9n0v0qt6huaio0assinn5pn" MODIFIED="1426313405454" TEXT="由第三方应用和插件支持的协议"><node CREATED="1426313405454" ID="1pok01pavtvssjbcvbj3j1afm3" MODIFIED="1426313405454" TEXT="浏览器根据URL的匹配情况转给外部的某个应用"/><node CREATED="1426313405454" ID="75e60gb3kkdffhsghi352b7s0u" MODIFIED="1426313405454" TEXT="协议"><node CREATED="1426313405454" ID="6e4onj2dkrmrckbs4a0jh828vr" MODIFIED="1426313405454" TEXT="acrobat:"/><node CREATED="1426313405454" ID="4u2udgsfbn69vcjifl4e43sa61" MODIFIED="1426313405454" TEXT="callto:，sip:"/><node CREATED="1426313405454" ID="61pon679dq4jjoklumjpd6fjom" MODIFIED="1426313405454" TEXT="daap:，itpc:，itms:"/><node CREATED="1426313405454" ID="1iue5kcd6kqpk9kt8r4sf2l3gp" MODIFIED="1426313405454" TEXT="mailto:，news:，nntp:"/><node CREATED="1426313405454" ID="0m6elms6jv93aha2jmaqkokhb7" MODIFIED="1426313405454" TEXT="mmst:，mmsu:，msbd:，rtsp:"/><node CREATED="1426313405454" ID="4tq0dmj1qavgvvhj9cakhopa50" MODIFIED="1426313405454" TEXT="firefoxurl:，cf:"/></node><node CREATED="1426313405454" ID="2ov9eqvr5d1lmv5sm2odro0l2k" MODIFIED="1426313405454" TEXT="注意"><node CREATED="1426313405454" ID="69kgr0mqjntsv78o72klbf3puu" MODIFIED="1426313405454" TEXT="第三方协议的处理程序可能漏洞百出"/></node></node><node CREATED="1426313405454" ID="019v9ifg5ove0f8gk4h83fpeem" MODIFIED="1426313405454" TEXT="未封装的伪协议"><node CREATED="1426313405454" ID="01i8djtqvhihgu3h18tfacnmqt" MODIFIED="1426313405454" TEXT="访问浏览器脚本解析引擎和某些内部功能，不需要从远端获取数据，一般无法通过互联网访问到"/><node COLOR="#FF0000" CREATED="1426313405454" ID="4tmbtqfl3psfmvpanltbo2pldj" MODIFIED="1426313405454" TEXT="危险协议"><node CREATED="1426313405454" ID="26qbvu3tad98skk6c7vlshcu7r" MODIFIED="1426313405454" TEXT="javascript:"><node CREATED="1426313405454" ID="5ai9fl8hg6dlu0ceg0hsh7tl4r" MODIFIED="1426313405454" TEXT="早期别名livescript:或mocha:"/><node CREATED="1426313405454" ID="2jj90ua8116m7qk9d028ec31tf" MODIFIED="1426313405454" TEXT="在当前浏览器访问的网页环境中，调用JS解析引擎"/><node CREATED="1426313405454" ID="36b7i0rkp2bl41uptg05omct3p" MODIFIED="1426313405454" TEXT="IE还有vbscript:"/></node><node CREATED="1426313405454" ID="4p2tplqcj14qknt7airr6qn4aj" MODIFIED="1426313405454" TEXT="data:"><node CREATED="1426313405454" ID="2phdj3cefr1tj04gve8b5v8rpm" MODIFIED="1426313405454" TEXT="不需要额外的网络请求，能创建一个短小的内置式文档"/></node></node></node><node CREATED="1426313405454" ID="2uqb7feome5thi7v3vf5pk09sa" MODIFIED="1426313405454" TEXT="封装过的伪协议"><node CREATED="1426313405454" ID="7ie13308mktod0eqv35djh4isq" MODIFIED="1426313405454" TEXT="放在任意URL前，指示将取回的内容强制进行特殊的解码或渲染显示"/><node CREATED="1426313405454" ID="52qc3t3bqukbmf3el9e3t4mqio" MODIFIED="1426313405454" TEXT="协议"><node CREATED="1426313405455" ID="0k781qjog3rc1qq628ohp0v4o7" MODIFIED="1426313405455" TEXT="view-source:"><node CREATED="1426313405455" ID="6r0bk2hjq04b6sjns85afc4jas" MODIFIED="1426313405455" TEXT="查看源码"/></node><node CREATED="1426313405455" ID="235ae8l6rfppcnfadgjg5dcf6j" MODIFIED="1426313405455" TEXT="jar:"><node CREATED="1426313405455" ID="6cn4iukv7ouafuct7mme0a5usa" MODIFIED="1426313405455" TEXT="Firefox：解压类似ZIP的文件内容"/></node><node CREATED="1426313405455" ID="0qcbhiiugcqifli0ijqnh38k8f" MODIFIED="1426313405455" TEXT="wyciwyg:和view-cache:"><node CREATED="1426313405455" ID="05ba9cjprfftqasu6mk9sido40" MODIFIED="1426313405455" TEXT="Firefox和Chrome查看浏览器缓存"/></node><node CREATED="1426313405455" ID="0bg8nbd6i1pthdrg17n23idtkk" MODIFIED="1426313405455" TEXT="oddballfeed:"><node CREATED="1426313405455" ID="14083u0ev78qvvrrvu1kgfa6jl" MODIFIED="1426313405455" TEXT="Safari：获得新闻推送信息"/></node><node CREATED="1426313405455" ID="3kv7lvvuljsspjeb0jjgt2vpj8" MODIFIED="1426313405455" TEXT="hcp:，its:，mhtml:，mk:，ms-help:，ms-its:，ms-itss:"><node CREATED="1426313405455" ID="2artsgcil2ho7krnpchtubu3sb" MODIFIED="1426313405455" TEXT="Windows相关"/><node CREATED="1426313405455" ID="7aa1atbrj0dbk50nk7m6jnvv5a" MODIFIED="1426313405455" TEXT="文档少"/></node></node><node CREATED="1426313405455" ID="6lqhjrbqgn2nacdgb4msku8ent" MODIFIED="1426313405455" TEXT="攻击方式"><node CREATED="1426313405455" ID="0khm6ltfguop60efagsbu55148" MODIFIED="1426313405455" TEXT="隐藏最后实际由浏览器处理的真实URL"/><node CREATED="1426313405455" ID="2lea9bncrkdnjk9uvpua77ere1" MODIFIED="1426313405455" TEXT="mhtml:等协议中，会忽略服务器返回的HTTP内容设置指令"/></node></node><node CREATED="1426313405455" ID="3trmstk9l0rgtm81r5kg6dpcmc" MODIFIED="1426313405455" TEXT="关于协议检测部分的结语"/></node><node CREATED="1426313405455" ID="7i27b2r2e2s1ickuf72lrneeen" MODIFIED="1426313405455" POSITION="left" TEXT="相对URL的解析"><node CREATED="1426313405455" ID="21klcpniov22rv7cgkavgue016" MODIFIED="1426313405455" TEXT="RFC定义：URL字符串不是以有效协议名开始，后面没有跟冒号，或没有//，就是相对URL"/><node CREATED="1426313405455" ID="2amjkhftv085ojulvi2ocli7vl" MODIFIED="1426313405455" TEXT="URL变型"><node CREATED="1426313405455" ID="33nv5hoil2267h7uprt0fgbniv" MODIFIED="1426313405455" TEXT="有协议名称，但没有授权信息（http:foo.txt）"><node CREATED="1426313405455" ID="5b0hiook5hg563c5l1ee59ug64" MODIFIED="1426313405455" TEXT="早期规范疏忽造成的漏洞"/></node><node CREATED="1426313405455" ID="0pgrn5692hmnheg6gjsvlmr0gd" MODIFIED="1426313405455" TEXT="没有协议名，但有授权信息（//example.com）"><node CREATED="1426313405455" ID="466nbf21ale71ttmgfforjl2eb" MODIFIED="1426313405455" TEXT="浏览器做法"><node CREATED="1426313405455" ID="10tfgn0oi9ct0da20qnlcag3j7" MODIFIED="1426313405455" TEXT="保持当前页面的协议，字符串作为新的授权信息段"/></node></node><node CREATED="1426313405455" ID="3sujickjpu33kmk75sahmmsplh" MODIFIED="1426313405455" TEXT="没有协议名，没有授权信息，但有路径（../notes.txt）"><node CREATED="1426313405455" ID="3se55lgv6fn55sbbver6uilr98" MODIFIED="1426313405455" TEXT="最常见形态"/></node><node CREATED="1426313405455" ID="5mo1lnms72q3vm15a0crpcfmhn" MODIFIED="1426313405455" TEXT="没有协议名、授权信息、路径，但有查询字符串（?search=bunnies）"/><node CREATED="1426313405455" ID="4o0ko15fak3hnee9uvdl9urom3" MODIFIED="1426313405455" TEXT="只有片段ID（#bunnis）"/></node><node CREATED="1426313405455" ID="58jp5fi814clr45m4e2b4sadso" MODIFIED="1426313405455" TEXT="处理相对URL时，不直接输出任何用户提供的相对URL是靠谱的"/></node><node CREATED="1426313405455" ID="3e5iivdu604vikrmdqbcc1jas1" MODIFIED="1426313405455" POSITION="left" TEXT="安全工程速查表"><node CREATED="1426313405455" ID="7v7uliia5rqp29ej6nv0m32mb5" MODIFIED="1426313405455" TEXT="构建基于用户输入的全新URL时"><node CREATED="1426313405455" ID="4brgletcr4t0u4od1ue7o0odnc" MODIFIED="1426313405455" TEXT="如果允许用户构造URL的路径、查询或片段ID几部分"><node CREATED="1426313405455" ID="3bqs600tn0l0o5da486ridlvu9" MODIFIED="1426313405455" TEXT="除了字母数字，全部转义"/></node><node CREATED="1426313405455" ID="4cujso6pbmp56mo4k9qd306m9g" MODIFIED="1426313405455" TEXT="如果允许用户提供协议名称或授权信息部分数据"><node CREATED="1426313405455" ID="522b6qe1mlneiumu4ro2b9gqrh" MODIFIED="1426313405455" TEXT="输入验证"/></node></node><node CREATED="1426313405455" ID="614iuftahvvc906nhjqnqtptom" MODIFIED="1426313405455" TEXT="设计URL输入过滤器"><node CREATED="1426313405455" ID="2ao547cm2huaompr5dp74otd8e" MODIFIED="1426313405455" TEXT="相对URL"><node CREATED="1426313405455" ID="32sj2vrfcmvpcqjmdfv5u4qgeg" MODIFIED="1426313405455" TEXT="禁用"/></node><node CREATED="1426313405455" ID="4dghsth9ahi1e0dqmtfhq9vqvk" MODIFIED="1426313405455" TEXT="协议名称"><node CREATED="1426313405455" ID="0blo8dr1p6hrq8g9kmd8pgk9gf" MODIFIED="1426313405455" TEXT="白名单"/></node><node CREATED="1426313405455" ID="2tn8uencanqovgrigmrmim4l6g" MODIFIED="1426313405455" TEXT="授权信息部分"><node CREATED="1426313405455" ID="08vhmvjhfvncfb4n242us4tsgi" MODIFIED="1426313405455" TEXT="只允许数字字母、&quot;-&quot;和&quot;.&quot;在主机部分，后边只能跟着&quot;/&quot;、&quot;?&quot;、&quot;#&quot;或字符串结束符"/><node CREATED="1426313405455" ID="3vqsldkhd67k2202uk97bofmqc" MODIFIED="1426313405455" TEXT="检查主机名时，从右往左截取匹配"/><node CREATED="1426313405455" ID="4vdue6tllu96l5099jl53led92" MODIFIED="1426313405455" TEXT="罕见情况下，检查IDNA、IPV6括号表示法、端口号和HTTP验证授权信息"/></node></node><node CREATED="1426313405455" ID="77ra7bk9sishghieg2pavd1a71" MODIFIED="1426313405455" TEXT="需要从接收到的URL里进行参数解码"><node CREATED="1426313405455" ID="5kru0l65heq1anivbt44b534b5" MODIFIED="1426313405455" TEXT="严格过滤"/></node></node></node></map>